# 数字底座接入文档

-- --

## 应用介绍

数字底座为不同渠道应用提供两种方式的数据接入，任意格式的文件和文本数据。可以是加工和未加工的数据形式。数字底座具备多路并发数据分发能力。

## 主要功能：

### 1.用户权限体系

权限列表

| 权限名称 | 权限说明 | 关联api/事件                                      |
|------|------|-----------------------------------------------|
|  获取用户信息 |   获得用户读取权限，可查询个人基础信息   | 批量获取用户<br/>获取用户详情<br/>获取用户列表                  |
|  更新用户信息 | 针对个人当前基础属性更新     | 修改用户部分信息<br/>更新用户所有信息                         |
| 获取角色列表  | 获取当前角色列表     | 批量获取当前组的角色列表                                  |
|获取角色属性   |获取当前指定角色的属性      | 获取指定角色的基本属性                                   |
|   创建用户  |   创建用户              | 创建用户                                          |
| 文件数据    |设定文件数据接入的基础格式                 | 设定文件数据 <br/>获取文件组<br/> 获取文件组下文件列表<br/>获取实际数据详情 |
| 文本数据    | 设定文本数据接入的基础格式                | 设定文本数据设置<br/>获取文本组<br/>获取文件组下文件列表<br/>获取实际数据详情 |
|   数据授权      | 验证当前用户的数据权限                             | 获取用户对应的数据权限                                   |
|  获取文件数据       |根据参数获取对应文件数据                              | 获取文件数据流地址                                     |
|  获取文本数据       | 根据参数获取对应文本数据                             | 获取文本数据                                        |
|校验算法组               |校验用户算法能力集                                          | 获取权限                                          |
|调用算法               |与平台算法进行能力交互                                          | 调用算法                                          |
| 主机管理                  |主机通用能力管理                                                     | 获取主机的列表信息<br/>获取主机的详细信息<br/> 获取系统信息<br/> 删除主机 |
|进程管理                   |管理当前服务器进程信息                                                     | 获取进程列表<br/>添加进程信息<br/>查看进程明细<br/>删除进程<br/>删除进程 <br/>查看进程统计图        |
|通用数据                   |获取通用数据集                                                     |获取监控进程<br/>进程CPU占比<br/>获取数据源<br/>获取监控数据表数量<br/>获取数据表总数据量<br/>获取服务接口数量<br/>获取异常服务接口<br/>获取系统日志                                              |
|通用能力                   |获取验证码                                                     |生成验证码                                               |
|                   |                                                     |                                               |
|                   |                                                     |                                               |

### 2.数据接入

数字底座支持文件数据接入和文本数据接入两种方式。文件数据存储于MinIO，文本数据存储于elasticsearch。支持自定义MinIO bucket 和 Elasticsearch index。并将数据存储到指定的bucket
和index中。均可以在数字底座平台上完成相关操作。

**基础术语：**

bucket：文件数据隔离维度，即为MinIO 的桶概念。bucket 名称只支持英文小写，不符合规范无法成功创建bucket。同一个bucket 下的文件名必须唯一，否则后上传的会自动覆盖之前上传的文件。不同bucket
下的文件名可以重复。

index: 文本数据隔离维度，即为Elasticsearch 的index概念。index名称只支持英文小写和数字，不符合命名规范无法成功创建索引。

#### 2.1文件数据接入

文件接入支持自定义bucket，并将数据上传到指定的bucket中。

##### 2.1.1 文件存储设置

登录成功后即可在 数字底座 -> 文件 菜单下设置文件存储隔离并上传文件。点击 新建桶 按钮，在弹出的弹窗中输入桶名称，桶名称只支持英文小写。

创建一个bucket
![](images/addBucket.png)

输入bucket名称
![](images/addBucket2.png)

##### 2.1.2 文件上传

创建bucket 后，点击操作栏上的 上传文件 按钮，弹出的弹窗中会自动写入上传的桶名称、文件名称（上传文件名）、文件大小信息，点击 上传按钮即会自动将文件上传到对应的bucket 中。

上传文件到对应的bucket 中
![](images/addBucketFile.png)

填写上传表单（表单数据会自动填充，正常情况下无需修改）
![](images/addBucketFile2.png)

**注意：同一个bucket 下的文件名称必须唯一，否则后上传的会自动覆盖之前上传的文件！！！**

#### 2.2 文本数据接入

文本接入支持自定义 index。并将数据存储到指定的index中。

##### 2.2.1 文本存储设置

文本存储设置支持在数字底座平台或者通过API接口两种方式进行设置。

**数字底座可视化操作创建方式**

连接到Elasticsearch 管理平台
![](images/connectElasticsearch.png)

在右上角 Indices -> Indices Summary -> Create Index 中可以创建一个索引。
![](images/ElasticsearchIndex.png)

在Indices Summary页面中，点击右上角的Create Index 创建一个新的索引
![](images/ElasticsearchIndexCreate.png)

填写index 创建参数
![](images/ElasticsearchIndexCreateForm.png)

**创建参数说明：**

Name: 索引名称，即为Elasticsearch index 概念。

Number of Shards:
Shards是将索引分成多个部分的逻辑单位。每个shard都是一个Lucene索引，由Elasticsearch集群中的多个节点共同维护。通常，增加shard的数量可以提高查询的并发性能，但同时也会增加系统的负载。推荐每个索引设置shards为5。

Number of Replicas:Replicas
是shard的副本。每个shard可以有多个replica，这些replica分别存储在Elasticsearch集群中的不同节点上，从而实现了数据的冗余备份和高可用性。增加replica的数量可以提高数据的可用性和容错能力，但同时也会占用更多的硬件资源。推荐每个索引设置Replicas为2.

**API接口创建方式**

**创建索引接口**

**接口地址：**
https://domain/textData/createIndex

**请求方式：**
POST

**请求参数：*

|    参数名    |   类型    | 是否必选 | 最大长度 |   描述   |         示例值         |
|:---------:|:-------:|:----:|:----:|:------:|:-------------------:|
| indexName | String  |  是   |  32  |  索引名称  | highwaytrifficIndex |
|  shards   | Integer |  否   |  /   |  逻辑单位  |          5          |
| replicas  | Integer |  否   |  /   | 数据备份数目 |          2          |

**响应参数：**

|  参数名   |   类型    | 是否必选 | 最大长度 |    描述     | 示例值  |
|:------:|:-------:|:----:|:----:|:---------:|:----:|
| result | Boolean |  是   |  /   | 创建是否成功标志位 | true |

**请求参数示例：**

```json
{
  "indexName": "highwaytrifficIndex",
  "shards": 5,
  "replicas": 2
}
```

**响应参数示例：**

```json
{
  "result": true
}
```

##### 2.2.2 文本上传

可通过API接口方式进行文本数据上传。

**API接口上传数据**

**上传文本数据接口**

**接口地址：**
https://domain/textData/uploadText

**请求方式：**
POST

**请求参数：*

|    参数名    |   类型   | 是否必选 | 最大长度 |        描述         |         示例值          |
|:---------:|:------:|:----:|:----:|:-----------------:|:--------------------:|
| indexName | String |  是   |  32  |       索引名称        | highwaytrifficIndex  |
|    id     | String |  否   |  32  |       数据ID        | DfLTLYgBksvt60QqvzgC |
|   data    | String |  否   |  /   | 要上传的数据，必须是JSON字符串 |          {}          |

**响应参数：**

|   参数名    |   类型   | 是否必选 | 最大长度 |     描述      | 示例值 |
|:--------:|:------:|:----:|:----:|:-----------:|:---:|
| textData | String |  是   |  /   | 文本JSON字符串数据 | {}  |

### 3.数据使用

#### 3.1文件数据获取

#### 3.1.1 查询文件数据接口

**接口地址：**
https://domain/fileData/searchFile

**请求方式：**
POST

**请求参数：*

|    参数名     |   类型   | 是否必选 | 最大长度 |  描述  |          示例值          |
|:----------:|:------:|:----:|:----:|:----:|:---------------------:|
| bucketName | String |  是   |  32  | 桶名称  | highwaytrifficpicture |
|     fileName     | String |  是   | 128  | 文件名称 | 00085117-00002814.jpg  |

**响应参数：**

|    参数名    |   类型   | 是否必选 | 最大长度 |    描述    | 示例值 |
|:---------:|:------:|:----:|:----:|:--------:|:---:|
| fileBytes | byte[] |  是   |  /   | 文件二进制文件流 | /  |

**请求参数示例：**

```json
{
  "bucketName": "highwaytrifficpicture",
  "fileName": "00085117-00002814.jpg"
}
```

**响应参数示例：**

```json
{
  "fileBytes": []
}
```

#### 3.2 文本数据获取

可以通过平台API接口获取文本数据，或者在数字底座平台上查询文本数据。

#### 3.2.1 查询文本数据接口

**接口地址：**
https://domain/textData/searchTextById

**请求方式：**
POST

**请求参数：*

|    参数名    |   类型   | 是否必选 | 最大长度 |        描述         |          示例值          |
|:---------:|:------:|:----:|:----:|:-----------------:|:---------------------:|
| indexName | String |  是   |  32  |       索引名称        |  highwaytrifficIndex  |
|    id     | String |  否   |  32  |       数据ID        | DfLTLYgBksvt60QqvzgC  |
|  fields   | String |  否   |  32   | 需要显示的字段，逗号分隔（缺省为全部字段） | fieldName1,fieldName2 |

**响应参数：**

|   参数名    |   类型   | 是否必选 | 最大长度 |     描述      | 示例值 |
|:--------:|:------:|:----:|:----:|:-----------:|:---:|
| textData | String |  是   |  /   | 文本JSON字符串数据 | {}  |

**请求参数示例：**

```json
{
  "indexName": "highwaytrifficIndex",
  "id": "DfLTLYgBksvt60QqvzgC",
  "fields": "fieldName1,fieldName2"
}
```

**响应参数示例：**

```json
{
  "textData": {}
}
```

#### 3.2.2 数字底座平台查询数据

也可在数字底座平台上查看和管理当前Elasticsearch 的索引和数据。
![](images/ElasticsearchIndexQuery.png)

### 4.算法运行支撑

@博文 补充

### 5.资源运行监控

@建荣补充

### 6.主机管理

@建荣补充

### 7.应用权限

调用数字底座能力时，离不开调用服务端接口，这些操作会访问用户，操作用户的信息。在实际使用过程中，应用需要申请资源访问的权限，并经过开放平台
或者租户管理员审核后，才可以使用权限绑定的开放能力。开发者可以进入开发者后台，在权限管理页面的权限配置区域，批量开通所需的api权限和对应的插件能力。 权限列表

